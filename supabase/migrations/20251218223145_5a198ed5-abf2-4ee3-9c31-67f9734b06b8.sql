-- =====================================================
-- AI CLAIM SCRUBBER - SEED DATA
-- Loads MUE edits, NCCI bundles, modifier rules,
-- medical necessity mappings, and payer rules
-- =====================================================

-- =====================================================
-- MUE EDITS (Medically Unlikely Edits)
-- Common CPT codes with their unit limits
-- =====================================================
INSERT INTO public.mue_edits (cpt_code, practitioner_limit, facility_limit, rationale) VALUES
-- E/M Office Visits (limit 1 per day)
('99202', 1, 1, 'C'),
('99203', 1, 1, 'C'),
('99204', 1, 1, 'C'),
('99205', 1, 1, 'C'),
('99211', 1, 1, 'C'),
('99212', 1, 1, 'C'),
('99213', 1, 1, 'C'),
('99214', 1, 1, 'C'),
('99215', 1, 1, 'C'),
-- E/M Hospital (99231-99233 can be 3/day for progress notes)
('99221', 1, 1, 'C'),
('99222', 1, 1, 'C'),
('99223', 1, 1, 'C'),
('99231', 3, 3, 'C'),
('99232', 3, 3, 'C'),
('99233', 3, 3, 'C'),
('99238', 1, 1, 'C'),
('99239', 1, 1, 'C'),
-- E/M Emergency
('99281', 1, 1, 'C'),
('99282', 1, 1, 'C'),
('99283', 1, 1, 'C'),
('99284', 1, 1, 'C'),
('99285', 1, 1, 'C'),
-- Cardiology - ECG
('93000', 1, 2, 'C'),
('93005', 1, 2, 'C'),
('93010', 1, 2, 'C'),
('93015', 1, 1, 'C'),
('93016', 1, 1, 'C'),
('93017', 1, 1, 'C'),
('93018', 1, 1, 'C'),
-- Cardiology - Holter/Monitoring
('93224', 1, 1, 'C'),
('93225', 1, 1, 'C'),
('93226', 1, 1, 'C'),
('93227', 1, 1, 'C'),
('93228', 1, 1, 'C'),
('93229', 1, 1, 'C'),
('93241', 1, 1, 'C'),
('93242', 1, 1, 'C'),
('93243', 1, 1, 'C'),
('93244', 1, 1, 'C'),
('93245', 1, 1, 'C'),
('93246', 1, 1, 'C'),
('93247', 1, 1, 'C'),
('93248', 1, 1, 'C'),
-- Cardiology - Echo
('93303', 1, 1, 'C'),
('93304', 1, 1, 'C'),
('93306', 1, 1, 'C'),
('93307', 1, 1, 'C'),
('93308', 1, 1, 'C'),
('93312', 1, 1, 'C'),
('93313', 1, 1, 'C'),
('93314', 1, 1, 'C'),
('93315', 1, 1, 'C'),
('93316', 1, 1, 'C'),
('93317', 1, 1, 'C'),
('93318', 1, 1, 'C'),
('93320', 1, 1, 'C'),
('93321', 1, 1, 'C'),
('93325', 1, 1, 'C'),
('93350', 1, 1, 'C'),
('93351', 1, 1, 'C'),
-- Labs - Common Panels
('80048', 1, 1, 'D'),
('80050', 1, 1, 'D'),
('80053', 1, 1, 'D'),
('80061', 1, 1, 'D'),
('80076', 1, 1, 'D'),
('85025', 1, 1, 'D'),
('85027', 1, 1, 'D'),
('36415', 3, 3, 'C'),
-- Radiology - Chest
('71045', 2, 2, 'C'),
('71046', 2, 2, 'C'),
('71047', 2, 2, 'C'),
('71048', 2, 2, 'C'),
('71250', 1, 1, 'C'),
('71260', 1, 1, 'C'),
('71270', 1, 1, 'C'),
('71271', 1, 1, 'C'),
-- Procedures - Minor
('10060', 2, 2, 'C'),
('10061', 1, 1, 'C'),
('10120', 2, 2, 'C'),
('10121', 1, 1, 'C'),
('10140', 2, 2, 'C'),
('10160', 2, 2, 'C'),
-- Skin Procedures
('11102', 3, 3, 'C'),
('11103', 3, 3, 'C'),
('11104', 3, 3, 'C'),
('11105', 3, 3, 'C'),
('11106', 3, 3, 'C'),
('11107', 3, 3, 'C'),
('11300', 4, 4, 'C'),
('11301', 4, 4, 'C'),
('11302', 4, 4, 'C'),
('11303', 4, 4, 'C'),
('11305', 4, 4, 'C'),
('11306', 4, 4, 'C'),
('11307', 4, 4, 'C'),
('11308', 4, 4, 'C'),
-- Injections
('96372', 4, 4, 'C'),
('96373', 4, 4, 'C'),
('96374', 4, 4, 'C'),
('96375', 4, 4, 'C'),
('96376', 4, 4, 'C'),
-- Joint Injections
('20600', 2, 2, 'C'),
('20604', 2, 2, 'C'),
('20605', 2, 2, 'C'),
('20606', 2, 2, 'C'),
('20610', 2, 2, 'C'),
('20611', 2, 2, 'C')
ON CONFLICT ON CONSTRAINT mue_cpt_unique DO UPDATE SET
  practitioner_limit = EXCLUDED.practitioner_limit,
  facility_limit = EXCLUDED.facility_limit,
  rationale = EXCLUDED.rationale;

-- =====================================================
-- NCCI PTP EDITS (Bundling Rules)
-- Code pairs that should not be billed together
-- modifier_indicator: 0=never, 1=with modifier, 9=N/A
-- =====================================================
INSERT INTO public.ncci_ptp_edits (column_1_cpt, column_2_cpt, modifier_indicator) VALUES
-- ECG Bundles (Complete bundles components)
('93000', '93005', '0'),
('93000', '93010', '0'),
('93005', '93010', '0'),
-- E/M Cannot Bill Multiple Levels Same Day
('99205', '99204', '0'),
('99205', '99203', '0'),
('99205', '99202', '0'),
('99204', '99203', '0'),
('99204', '99202', '0'),
('99203', '99202', '0'),
('99215', '99214', '0'),
('99215', '99213', '0'),
('99215', '99212', '0'),
('99215', '99211', '0'),
('99214', '99213', '0'),
('99214', '99212', '0'),
('99214', '99211', '0'),
('99213', '99212', '0'),
('99213', '99211', '0'),
('99212', '99211', '0'),
-- Echo Bundles
('93306', '93307', '0'),
('93306', '93308', '0'),
('93306', '93320', '0'),
('93306', '93321', '0'),
('93307', '93308', '0'),
('93312', '93306', '0'),
('93312', '93307', '0'),
('93312', '93308', '0'),
('93312', '93320', '0'),
('93312', '93321', '0'),
('93350', '93306', '0'),
('93350', '93307', '0'),
('93351', '93350', '0'),
-- Holter Bundles
('93224', '93225', '0'),
('93224', '93226', '0'),
('93224', '93227', '0'),
('93225', '93226', '0'),
('93225', '93227', '0'),
('93226', '93227', '0'),
('93228', '93229', '1'),
('93241', '93242', '0'),
('93241', '93243', '0'),
('93241', '93244', '0'),
('93245', '93246', '0'),
('93245', '93247', '0'),
('93245', '93248', '0'),
-- Lab Bundles (Comprehensive includes basic)
('80053', '80048', '0'),
('80050', '80053', '0'),
('80050', '80048', '0'),
('80061', '82465', '0'),
('80061', '83718', '0'),
('80061', '84478', '0'),
('85025', '85027', '0'),
-- Injection Bundles
('96374', '96375', '0'),
('96372', '96373', '0'),
('96375', '96376', '0'),
-- X-ray Bundles (Complete includes views)
('71046', '71045', '0'),
('71047', '71045', '0'),
('71047', '71046', '0'),
('71048', '71045', '0'),
('71048', '71046', '0'),
('71048', '71047', '0'),
-- Chest CT Bundles
('71260', '71250', '0'),
('71270', '71250', '0'),
('71270', '71260', '0'),
('71271', '71270', '0'),
-- Biopsy Bundles
('11102', '11103', '1'),
('11104', '11105', '1'),
('11106', '11107', '1'),
-- Joint Injection Bundles (Same joint)
('20610', '20600', '0'),
('20610', '20605', '0'),
('20611', '20604', '0'),
('20611', '20606', '0')
ON CONFLICT ON CONSTRAINT ncci_pair_unique DO UPDATE SET
  modifier_indicator = EXCLUDED.modifier_indicator;

-- =====================================================
-- MODIFIER RULES
-- When and how modifiers should be used
-- =====================================================
INSERT INTO public.modifier_rules (modifier, modifier_description, required_with_cpt_categories, required_conditions, requires_documentation) VALUES
('25', 'Significant, Separately Identifiable E/M Service', 
  ARRAY['E/M with same-day procedure'], 
  ARRAY['E/M billed with procedure on same day', 'E/M must be separately identifiable', 'Must be above and beyond usual pre/post work'],
  true),
('26', 'Professional Component', 
  ARRAY['Radiology', 'Pathology', 'Diagnostic'], 
  ARRAY['When billing only professional interpretation', 'Cannot bill with TC on same code'],
  false),
('TC', 'Technical Component', 
  ARRAY['Radiology', 'Pathology', 'Diagnostic'], 
  ARRAY['When billing only technical/equipment portion', 'Cannot bill with 26 on same code'],
  false),
('59', 'Distinct Procedural Service', 
  ARRAY['Multiple procedures', 'NCCI override'], 
  ARRAY['Different session', 'Different anatomic site', 'Separate incision/excision', 'Separate lesion', 'Separate injury'],
  true),
('XE', 'Separate Encounter', 
  ARRAY['Same day different encounter'], 
  ARRAY['Service provided during separate encounter on same day'],
  true),
('XS', 'Separate Structure', 
  ARRAY['Different anatomic structure'], 
  ARRAY['Service performed on separate organ or structure'],
  false),
('XP', 'Separate Practitioner', 
  ARRAY['Different provider'], 
  ARRAY['Service performed by different practitioner'],
  false),
('XU', 'Unusual Non-Overlapping Service', 
  ARRAY['Non-overlapping service'], 
  ARRAY['Service does not overlap usual components of main service'],
  true),
('76', 'Repeat Procedure by Same Physician', 
  ARRAY['Repeat procedure'], 
  ARRAY['Same procedure repeated on same day by same physician'],
  false),
('77', 'Repeat Procedure by Different Physician', 
  ARRAY['Repeat procedure'], 
  ARRAY['Same procedure repeated on same day by different physician'],
  false),
('LT', 'Left Side', 
  ARRAY['Bilateral eligible procedures'], 
  ARRAY['Procedure performed on left side'],
  false),
('RT', 'Right Side', 
  ARRAY['Bilateral eligible procedures'], 
  ARRAY['Procedure performed on right side'],
  false),
('50', 'Bilateral Procedure', 
  ARRAY['Bilateral eligible procedures'], 
  ARRAY['Same procedure performed on both sides'],
  false),
('51', 'Multiple Procedures', 
  ARRAY['Multiple procedures same session'], 
  ARRAY['Multiple procedures during same operative session'],
  false),
('52', 'Reduced Services', 
  ARRAY['Partial procedure'], 
  ARRAY['Service reduced or eliminated at physician discretion'],
  true),
('53', 'Discontinued Procedure', 
  ARRAY['Discontinued procedure'], 
  ARRAY['Procedure discontinued due to patient safety concerns'],
  true),
('57', 'Decision for Surgery', 
  ARRAY['E/M with major surgery'], 
  ARRAY['E/M service resulted in initial decision to perform major surgery (90 day global)'],
  true),
('58', 'Staged or Related Procedure', 
  ARRAY['Related procedure during postoperative'], 
  ARRAY['Staged procedure during postoperative period', 'More extensive than original', 'Therapy following diagnostic'],
  true),
('78', 'Unplanned Return to OR', 
  ARRAY['Return to OR during global'], 
  ARRAY['Unplanned return to operating room for related procedure during postoperative period'],
  true),
('79', 'Unrelated Procedure During Postoperative', 
  ARRAY['Unrelated procedure during global'], 
  ARRAY['Unrelated procedure during postoperative period of another procedure'],
  true),
('24', 'Unrelated E/M During Postoperative', 
  ARRAY['E/M during global period'], 
  ARRAY['Unrelated E/M service during postoperative global period'],
  true),
('91', 'Repeat Clinical Lab Test', 
  ARRAY['Repeat lab test'], 
  ARRAY['Same lab test repeated on same day to obtain multiple results'],
  false),
('GC', 'Service Performed by Resident', 
  ARRAY['Teaching physician'], 
  ARRAY['Service performed in part by resident under direction of teaching physician'],
  false),
('GE', 'Service Performed by Resident Without Teaching Physician', 
  ARRAY['Primary care exception'], 
  ARRAY['Resident performed service under primary care exception'],
  false)
ON CONFLICT ON CONSTRAINT modifier_unique DO UPDATE SET
  modifier_description = EXCLUDED.modifier_description,
  required_with_cpt_categories = EXCLUDED.required_with_cpt_categories,
  required_conditions = EXCLUDED.required_conditions,
  requires_documentation = EXCLUDED.requires_documentation;

-- =====================================================
-- MEDICAL NECESSITY MATRIX
-- CPT to ICD mappings with support scores
-- =====================================================
INSERT INTO public.medical_necessity_matrix (cpt_code, icd_code, necessity_score, payer_type, notes) VALUES
-- Holter/Cardiac Monitoring (93224-93229)
('93224', 'R00.0', 95, 'all', 'Tachycardia supports Holter'),
('93224', 'R00.1', 95, 'all', 'Bradycardia supports Holter'),
('93224', 'R00.2', 95, 'all', 'Palpitations supports Holter'),
('93224', 'R00.8', 90, 'all', 'Other heart rhythm abnormalities'),
('93224', 'R00.9', 85, 'all', 'Unspecified heart rhythm'),
('93224', 'R55', 95, 'all', 'Syncope supports Holter'),
('93224', 'R42', 85, 'all', 'Dizziness supports Holter'),
('93224', 'I49.9', 95, 'all', 'Cardiac arrhythmia unspecified'),
('93224', 'I48.91', 95, 'all', 'Atrial fibrillation'),
('93224', 'I48.92', 95, 'all', 'Atrial flutter'),
('93228', 'R00.0', 95, 'all', 'Tachycardia supports MCOT'),
('93228', 'R00.1', 95, 'all', 'Bradycardia supports MCOT'),
('93228', 'R00.2', 95, 'all', 'Palpitations supports MCOT'),
('93228', 'R55', 95, 'all', 'Syncope supports MCOT'),
('93228', 'I49.9', 95, 'all', 'Cardiac arrhythmia'),
('93229', 'R00.0', 95, 'all', 'Tachycardia supports MCOT'),
('93229', 'R00.1', 95, 'all', 'Bradycardia supports MCOT'),
('93229', 'R00.2', 95, 'all', 'Palpitations supports MCOT'),
('93229', 'R55', 95, 'all', 'Syncope supports MCOT'),
('93229', 'I49.9', 95, 'all', 'Cardiac arrhythmia'),
-- ECG (93000)
('93000', 'R00.0', 90, 'all', 'Tachycardia'),
('93000', 'R00.1', 90, 'all', 'Bradycardia'),
('93000', 'R00.2', 90, 'all', 'Palpitations'),
('93000', 'R55', 90, 'all', 'Syncope'),
('93000', 'R07.9', 95, 'all', 'Chest pain'),
('93000', 'R07.89', 95, 'all', 'Other chest pain'),
('93000', 'I25.10', 95, 'all', 'CAD'),
('93000', 'I10', 85, 'all', 'Hypertension'),
('93000', 'I50.9', 90, 'all', 'Heart failure'),
('93000', 'I48.91', 95, 'all', 'Atrial fibrillation'),
('93000', 'I49.9', 90, 'all', 'Cardiac arrhythmia'),
-- Echo (93306)
('93306', 'I50.9', 95, 'all', 'Heart failure'),
('93306', 'I50.1', 95, 'all', 'Left heart failure'),
('93306', 'I50.20', 95, 'all', 'Systolic heart failure'),
('93306', 'I50.30', 95, 'all', 'Diastolic heart failure'),
('93306', 'I25.10', 95, 'all', 'CAD'),
('93306', 'I42.9', 95, 'all', 'Cardiomyopathy'),
('93306', 'I42.0', 95, 'all', 'Dilated cardiomyopathy'),
('93306', 'I34.0', 95, 'all', 'Mitral regurgitation'),
('93306', 'I35.0', 95, 'all', 'Aortic stenosis'),
('93306', 'I35.1', 95, 'all', 'Aortic regurgitation'),
('93306', 'R00.2', 85, 'all', 'Palpitations'),
('93306', 'R55', 85, 'all', 'Syncope'),
('93306', 'R06.02', 90, 'all', 'Shortness of breath'),
-- E/M Common Diagnoses
('99213', 'J06.9', 90, 'all', 'URI'),
('99213', 'J20.9', 90, 'all', 'Acute bronchitis'),
('99213', 'I10', 90, 'all', 'Hypertension'),
('99213', 'E11.9', 90, 'all', 'Type 2 Diabetes'),
('99213', 'E78.5', 90, 'all', 'Hyperlipidemia'),
('99213', 'M54.5', 90, 'all', 'Low back pain'),
('99214', 'I10', 90, 'all', 'Hypertension'),
('99214', 'E11.9', 90, 'all', 'Type 2 Diabetes'),
('99214', 'E11.65', 95, 'all', 'DM2 with hyperglycemia'),
('99214', 'I25.10', 95, 'all', 'CAD'),
('99214', 'I50.9', 95, 'all', 'Heart failure'),
('99214', 'J44.1', 90, 'all', 'COPD with exacerbation'),
('99215', 'I50.9', 95, 'all', 'Heart failure complex'),
('99215', 'E11.65', 95, 'all', 'DM2 uncontrolled'),
('99215', 'I25.10', 95, 'all', 'CAD complex'),
-- Labs
('80053', 'E11.9', 95, 'all', 'Diabetes - CMP'),
('80053', 'I10', 90, 'all', 'HTN - CMP'),
('80053', 'N18.9', 95, 'all', 'CKD - CMP'),
('80053', 'E87.6', 95, 'all', 'Hypokalemia'),
('80061', 'E78.5', 95, 'all', 'Hyperlipidemia - Lipid Panel'),
('80061', 'E78.0', 95, 'all', 'Pure hypercholesterolemia'),
('80061', 'E78.1', 95, 'all', 'Hypertriglyceridemia'),
('80061', 'I25.10', 90, 'all', 'CAD - lipid monitoring'),
('85025', 'D64.9', 95, 'all', 'Anemia - CBC'),
('85025', 'D50.9', 95, 'all', 'Iron deficiency anemia'),
('85025', 'R53.83', 90, 'all', 'Fatigue - CBC'),
-- Chest X-ray
('71046', 'J18.9', 95, 'all', 'Pneumonia'),
('71046', 'R05.9', 90, 'all', 'Cough'),
('71046', 'R06.02', 90, 'all', 'Shortness of breath'),
('71046', 'J44.9', 90, 'all', 'COPD'),
('71046', 'R07.9', 90, 'all', 'Chest pain')
ON CONFLICT ON CONSTRAINT necessity_pair_unique DO UPDATE SET
  necessity_score = EXCLUDED.necessity_score,
  notes = EXCLUDED.notes;

-- =====================================================
-- PAYER RULES
-- Payer-specific requirements and quirks
-- =====================================================
INSERT INTO public.payer_rules (payer_name, rule_type, cpt_codes, rule_description, action_required, severity, active) VALUES
-- Medicare Rules
('Medicare', 'modifier', ARRAY['99202','99203','99204','99205','99211','99212','99213','99214','99215'], 
  'E/M with same-day procedure requires modifier 25 with documentation supporting separate identifiable service', 
  'Add modifier 25 and ensure documentation supports separate E/M', 'high', true),
('Medicare', 'bundling', ARRAY['93000','93005','93010'], 
  'Bill only one ECG code per encounter - 93000 includes tracing and interpretation', 
  'Bill 93000 for complete ECG, remove 93005/93010', 'high', true),
('Medicare', 'frequency', ARRAY['93306'], 
  'Echocardiogram limited to once per year without documentation of significant change in clinical status', 
  'Document clinical change if repeat echo within 12 months', 'medium', true),
('Medicare', 'medical_necessity', ARRAY['93229','93228'], 
  'External cardiac monitoring requires documented arrhythmia symptoms (palpitations, syncope, dizziness)', 
  'Ensure symptoms documented in clinical notes', 'high', true),
('Medicare', 'lcd', ARRAY['93224','93225','93226','93227'], 
  'Holter monitor covered for documented arrhythmia evaluation only', 
  'Document symptoms: syncope, palpitations, dizziness, or known arrhythmia', 'critical', true),
-- BCBS Rules
('BCBS', 'authorization', ARRAY['93224','93225','93226','93227','93228','93229'], 
  'Holter and event monitoring may require prior authorization depending on plan', 
  'Verify prior auth requirements before service', 'medium', true),
('BCBS', 'modifier', ARRAY['99214','99215'], 
  'BCBS audits modifier 25 usage - ensure documentation clearly supports separate E/M service', 
  'Document time spent and distinct nature of E/M vs procedure', 'high', true),
('BCBS', 'bundling', ARRAY['93306','93320','93321'], 
  'BCBS bundles Doppler codes with complete echo', 
  'Bill 93306 only for complete TTE with Doppler', 'medium', true),
-- UnitedHealthcare Rules
('UnitedHealthcare', 'authorization', ARRAY['71250','71260','71270'], 
  'CT Chest requires prior authorization for non-emergent outpatient', 
  'Obtain prior auth or document emergency indication', 'high', true),
('UnitedHealthcare', 'bundling', ARRAY['93228','93229'], 
  'UHC may bundle MCOT technical and professional - verify contract', 
  'Check if global billing required', 'medium', true),
('UnitedHealthcare', 'frequency', ARRAY['80061'], 
  'Lipid panel covered once per year unless documented medical necessity for more frequent testing', 
  'Document reason if repeat within 12 months', 'low', true),
-- Aetna Rules
('Aetna', 'authorization', ARRAY['93306','93307','93308','93312'], 
  'Echocardiogram requires prior auth for non-emergent outpatient', 
  'Obtain prior authorization before scheduling', 'high', true),
('Aetna', 'modifier', ARRAY['59','XE','XS','XP','XU'], 
  'Aetna prefers X modifiers (XE,XS,XP,XU) over modifier 59 for distinct services', 
  'Use specific X modifier instead of 59 when applicable', 'medium', true),
-- Cigna Rules
('Cigna', 'authorization', ARRAY['93350','93351'], 
  'Stress echo requires prior authorization', 
  'Obtain prior auth before service', 'high', true),
('Cigna', 'medical_necessity', ARRAY['93306'], 
  'Echo requires documented cardiac symptoms or abnormal findings', 
  'Include symptoms: SOB, edema, murmur, abnormal ECG', 'high', true),
-- Humana Rules
('Humana', 'medical_necessity', ARRAY['93229','93228'], 
  'MCOT requires failed or inadequate Holter first for some plans', 
  'Document Holter results or why MCOT preferred', 'medium', true),
('Humana', 'frequency', ARRAY['93000'], 
  'ECG limited frequency - clinical indication required for repeat', 
  'Document new symptoms or clinical change', 'low', true),
-- General Rules (All Payers)
('All Payers', 'modifier', ARRAY['26','TC'], 
  'Cannot bill both professional (26) and technical (TC) components on same code by same provider', 
  'Bill global, 26 only, or TC only - not both', 'critical', true),
('All Payers', 'modifier', ARRAY['LT','RT','50'], 
  'Bilateral procedures: Use 50 for bilateral, or LT/RT for separate sides', 
  'Do not use LT+RT+50 together', 'high', true),
('All Payers', 'ncci', NULL, 
  'NCCI edits apply to all payers - check for bundled code pairs', 
  'Review NCCI edits before submission', 'high', true)
ON CONFLICT DO NOTHING;